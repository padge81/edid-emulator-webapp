<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>EDID Management</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #edidPreview { width: 100%; height: 200px; overflow: auto; border: 1px solid #ccc; padding: 10px; white-space: pre; }
  select, input, button { margin: 10px 0; display: block; width: 300px; }
</style>
</head>
<body>

<h2>EDID Files Management</h2>

<!-- Load and preview -->
<h3>Select Saved EDID File</h3>
<select id="savedFilesDropdown"></select>
<button onclick="loadAndPreview()">Load & Preview</button>

<h4>EDID Preview</h4>
<textarea id="edidPreview" readonly></textarea>

<!-- Buttons for actions -->
<button onclick="writeFromPreview()">Write EDID to Device</button>
<button onclick="verifyEDID()">Verify EDID</button>

<script>
// Load list of saved files on page load
window.onload = loadSavedFiles;

// Fetch list of saved files
function loadSavedFiles() {
    fetch('/list_files')
        .then(res => res.json())
        .then(data => {
            const dropdown = document.getElementById('savedFilesDropdown');
            dropdown.innerHTML = '';
            data.files.forEach(file => {
                const option = document.createElement('option');
                option.value = file;
                option.text = file;
                dropdown.appendChild(option);
            });
        });
}

// Load and preview selected EDID file
function loadAndPreview() {
    const filename = document.getElementById('savedFilesDropdown').value;
    fetch('/read_edid_file?filename=' + encodeURIComponent(filename))
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                alert('Error: ' + data.error);
                document.getElementById('edidPreview').value = '';
            } else {
                document.getElementById('edidPreview').value = data.edid_content;
            }
        });
}

// Write the EDID from the selected file to the device
function writeFromPreview() {
    const filename = document.getElementById('savedFilesDropdown').value;
    fetch('/write_edid_from_file', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename: filename, port: '2' }) // adjust port if needed
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message || data.error);
    });
}

// Verify if current EDID matches the selected file
function verifyEDID() {
    const filename = document.getElementById('savedFilesDropdown').value;
    fetch('/verify_edid', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename: filename, port: '2' }) // adjust port if needed
    })
    .then(res => res.json())
    .then(data => {
        if (data.match) {
            alert('Verification successful: EDID matches.');
        } else {
            alert('Verification failed: EDID does not match.');
        }
    });
}
</script>

</body>
</html>